#include <string.h>
#include <time.h>
#include <i3-lcd.h>

#define TAG "I3-MAIN"

//https://notisrac.github.io/FileToCArray/ with bmp file in 256 colors
uint8_t left[] = {
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0xe0, 0xe0, 0xe0, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xff, 0xa0, 0xe0, 0xe0, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x72, 0x4d, 0x04, 0x04, 0xa0, 0xe0, 0xe0, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xff, 0xed, 0xe0, 0xa0, 0x04, 0xa0, 0xa0, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xff, 0x04, 0xa0, 0x04, 0x04, 0xa0, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x72, 0x4d, 0xff, 0xf6, 0x04, 0xf6, 0xad, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xff, 0xfb, 0xf6, 0xf6, 0xf6, 0xf6, 0xad, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0xf6, 0xf6, 0xad, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xad, 0xad, 0xad, 0x04, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0x04, 0xe0, 0xe0, 0xe0, 0xa0, 0x04, 0x04, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xff, 0xff, 0xe0, 0xe0, 0xe0, 0xa0, 0xa0, 0xa0, 0x04, 0xf6, 0x04, 0x3c, 
  0x3c, 0x3c, 0x3c, 0xd0, 0xd0, 0xdf, 0xdf, 0xa0, 0xa0, 0xa0, 0x04, 0x04, 0x04, 0x04, 0xf6, 0xad, 0x29, 
  0x3c, 0x3c, 0x3c, 0x60, 0x60, 0x04, 0x04, 0x04, 0x04, 0x04, 0x13, 0x03, 0x03, 0x04, 0xf6, 0x04, 0xdf, 
  0x3c, 0x04, 0x04, 0x04, 0x60, 0x13, 0x13, 0x13, 0x13, 0x13, 0x03, 0x03, 0x04, 0x04, 0x04, 0x60, 0x6d, 
  0x04, 0x6d, 0x29, 0x04, 0x04, 0x03, 0x03, 0x03, 0x03, 0x03, 0x04, 0x04, 0x29, 0x6d, 0x29, 0x04, 0xdf, 
  0x04, 0xdf, 0x6d, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0xff, 0x04, 0x6d, 0xdf, 0x6d, 0x04, 0x6d, 
  0x04, 0x6d, 0x29, 0x04, 0x04, 0xff, 0xff, 0xff, 0xff, 0xff, 0x04, 0x04, 0x29, 0x6d, 0x29, 0x04, 0x04, 
  0x3c, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0x3c, 0x3c
};

uint8_t right[] = {
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0xe0, 0xe0, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0xe0, 0xe0, 0xe0, 0xa0, 0xff, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x04, 0xe0, 0xe0, 0xe0, 0xe0, 0xa0, 0x04, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x04, 0xe0, 0xe0, 0xa0, 0xa0, 0x04, 0xa0, 0xe0, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0xa0, 0x04, 0x04, 0xa0, 0x04, 0xff, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0x04, 0xad, 0xf6, 0x04, 0xf6, 0xff, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0x04, 0xad, 0xf6, 0xf6, 0xf6, 0xf6, 0xf6, 0xf6, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0xad, 0xf6, 0xf6, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0xe0, 0x04, 0xad, 0xad, 0xad, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x04, 0x04, 0xa0, 0xe0, 0xe0, 0xe0, 0x04, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x04, 0xf6, 0x04, 0xa0, 0xa0, 0xa0, 0xe0, 0xe0, 0xe0, 0xff, 0xff, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x29, 0xad, 0xf6, 0x04, 0x04, 0x04, 0x04, 0xa0, 0xa0, 0xa0, 0xdf, 0xdf, 0xd0, 0xd0, 0x3c, 0x3c, 0x3c, 
  0xdf, 0x04, 0xf6, 0x04, 0x03, 0x03, 0x13, 0x04, 0x04, 0x04, 0x04, 0x04, 0x60, 0x60, 0x3c, 0x3c, 0x3c, 
  0x6d, 0x60, 0x04, 0x04, 0x04, 0x03, 0x03, 0x13, 0x13, 0x13, 0x13, 0x13, 0x60, 0x04, 0x04, 0x04, 0x3c, 
  0xdf, 0x04, 0x29, 0x6d, 0x29, 0x04, 0x04, 0x03, 0x03, 0x03, 0x03, 0x03, 0x04, 0x04, 0x29, 0x6d, 0x04, 
  0x6d, 0x04, 0x6d, 0xdf, 0x6d, 0x04, 0xff, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x6d, 0xdf, 0x04, 
  0x04, 0x04, 0x29, 0x6d, 0x29, 0x04, 0x04, 0xff, 0xff, 0xff, 0xff, 0xff, 0x04, 0x04, 0x29, 0x6d, 0x04, 
  0x3c, 0x3c, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0x3c
};

uint8_t down[] = {
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0xe0, 0xe0, 0xe0, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0xe0, 0xa0, 0xff, 0xa0, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0x04, 0x04, 0x04, 0x04, 0x04, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0xa0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xa0, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0xdf, 0x04, 0xad, 0x04, 0xdf, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0xf6, 0x04, 0xff, 0x04, 0xf6, 0x04, 0xff, 0x04, 0xf6, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0xad, 0xf6, 0x04, 0xad, 0xf6, 0xad, 0x04, 0xf6, 0xad, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xad, 0xf6, 0x04, 0x04, 0x04, 0xf6, 0xad, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0xf6, 0xf6, 0xf6, 0xf6, 0xf6, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0xe0, 0xad, 0xad, 0xad, 0xad, 0xad, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x04, 0xa0, 0xff, 0xff, 0x60, 0x60, 0x60, 0xff, 0xff, 0xa0, 0x04, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xdf, 0xdf, 0x04, 0x04, 0x04, 0xdf, 0xdf, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 
  0x3c, 0x04, 0x04, 0x04, 0x03, 0xd0, 0xa0, 0x03, 0x04, 0x03, 0xa0, 0xd0, 0x03, 0x04, 0x04, 0x04, 0x3c, 
  0x04, 0x4d, 0x04, 0x04, 0xd0, 0x60, 0x60, 0x60, 0x04, 0x60, 0x60, 0x60, 0xd0, 0x04, 0x04, 0x4d, 0x04, 
  0x04, 0x29, 0x4d, 0x4d, 0xa0, 0x60, 0xdf, 0xdf, 0x04, 0xdf, 0xdf, 0x60, 0xa0, 0x4d, 0x4d, 0x29, 0x04, 
  0x04, 0x04, 0x29, 0x29, 0x04, 0xdf, 0x60, 0x60, 0x60, 0x60, 0x60, 0xdf, 0x04, 0x29, 0x29, 0x04, 0x04, 
  0x04, 0x04, 0x04, 0x04, 0x04, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x04, 0x04, 0x04, 0x04, 0x04, 
  0x3c, 0x3c, 0x04, 0x04, 0x04, 0x3c, 0x04, 0x04, 0x04, 0x04, 0x04, 0x3c, 0x04, 0x04, 0x04, 0x3c, 0x3c
};

uint8_t up[] = {
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x04, 0x3c, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xa0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xa0, 0xa0, 0x3c, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x3c, 0x04, 0x04, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x04, 0x04, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x3c, 0x04, 0xf6, 0x04, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0x04, 0xf6, 0x04, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x3c, 0x04, 0xad, 0xf6, 0x04, 0x04, 0x04, 0x04, 0x04, 0xf6, 0xad, 0x04, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xad, 0xf6, 0x04, 0x04, 0x04, 0xf6, 0xad, 0x04, 0x3c, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x04, 0xad, 0xe0, 0xe0, 0xe0, 0xad, 0x04, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x3c, 0x04, 0xe0, 0x13, 0x03, 0xa0, 0xa0, 0xa0, 0x03, 0x13, 0xe0, 0x04, 0x3c, 0x3c, 0x3c,
  0x3c, 0x3c, 0x04, 0xe0, 0xa0, 0x03, 0x04, 0xf6, 0xf6, 0xf6, 0x04, 0x03, 0xa0, 0xe0, 0x04, 0x3c, 0x3c,
  0x3c, 0x3c, 0x04, 0xa0, 0xa0, 0x04, 0xf6, 0xad, 0xad, 0xad, 0xf6, 0x04, 0xa0, 0xa0, 0x04, 0x3c, 0x3c,
  0x3c, 0x29, 0x29, 0x29, 0x03, 0x29, 0x29, 0x29, 0x29, 0x29, 0x29, 0x29, 0x03, 0x29, 0x29, 0x29, 0x3c,
  0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0xdf, 0xdf, 0xdf, 0xdf, 0xdf, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04,
  0x04, 0x4d, 0x4d, 0x4d, 0x04, 0xdf, 0x04, 0x6d, 0x6d, 0x6d, 0x04, 0xdf, 0x04, 0x4d, 0x4d, 0x4d, 0x04,
  0x04, 0x29, 0x29, 0x29, 0x04, 0xdf, 0x04, 0xdf, 0xdf, 0xdf, 0x04, 0xdf, 0x04, 0x29, 0x29, 0x29, 0x04,
  0x04, 0x04, 0x04, 0x04, 0x04, 0xa0, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0xa0, 0x04, 0x04, 0x04, 0x04, 0x04,
  0x3c, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0x04, 0x04, 0x3c, 0x3c, 0x04, 0x04, 0x04, 0x3c
};

#define SPRITE_WIDTH 17
#define SPRITE_HEIGHT 19


uint16_t x = 2;
uint16_t y = 2;

int8_t incX=1;
int8_t incY=0;
uint8_t *sprite = right;

/**
 *
 */
void moveSprite(){
  x += incX;
  y += incY;

  if (x > (LCD_WIDTH-SPRITE_WIDTH-3)){
    x--;
    incX=0;
    incY=1;
    sprite = down;
  }
  if (y > (LCD_HEIGHT-SPRITE_HEIGHT-3)){
    y--;
    incX=-1;
    incY=0;
    sprite = left;
  }
  if (x < 3){
    x++;
    incX=0;
    incY=-1;
    sprite = up;
  }
  if (y < 3){
    y++;
    incX=1;
    incY=0;
    sprite = right;
  }
}

/**
 * MAIN
 */
extern "C" void app_main(){
  esp_log_level_set(TAG       , ESP_LOG_VERBOSE); //Log level (ESP_LOG_NONE|ESP_LOG_VERBOSE)
  esp_log_level_set(I3_LCD_TAG, ESP_LOG_VERBOSE);

  ESP_LOGI(TAG, "Bonjour :-)");

  //------
  //LCD
  //------
  uint16_t *buffer = (uint16_t*)malloc(LCD_WIDTH * LCD_HEIGHT * sizeof(uint16_t));

  if (buffer != NULL) ESP_LOGI(TAG, "Initializing back buffer... OK");
  i3LcdInit();

  for(;;){
    i3LcdClear(buffer);
    //i3LcdString(buffer, 10, 10, "Inspir3 (c) 2026", LCD_COLOR_BLUE, 1);
    i3LcdSprite(buffer, sprite, x, y, SPRITE_WIDTH, SPRITE_HEIGHT, 1);
    i3LcdSwap(buffer);

    moveSprite();
    //ESP_LOGI(TAG, "x: %d incX: %d y: %d incY: %d", x, incX, y, incY);

    //vTaskDelay (5000 / portTICK_PERIOD_MS);
  }
}
